function randIntBorne(e,t){return Math.floor(Math.random()*(t-e)+e)}function Main(){var e=randIntBorne(0,QUOTES.length);THETEXT=QUOTES[e].text;$textToType.html(THETEXT.addSpan());$title.html(QUOTES[e].title);$author.html(QUOTES[e].author);whereAmI=0;whichWord=0;colorizeWord(0,"green");errorsCount=0;$inputTyping.val("");beginTime=null;realTimeWPM=[];typing=true}function asciiToChar(e){return String.fromCharCode(e)}function colorizeWord(e,t){$(".mot").css("background","none");$(".mot_"+e).css("background",t)}function calculeWPM(e,t){var n=Math.round(THETEXT.substr(0,whereAmI+1).countMot()/((t-e)/6e4)*100)/100;return n}function Stats(){var e=0;for(var t=0;t<realTimeWPM.length;t++){if(realTimeWPM[t][0]>100){realTimeWPM[t][0]=100}e+=realTimeWPM[t][0]}e=e/realTimeWPM.length;var n=new Date(new Date-beginTime);var r=Math.round((1-errorsCount/whereAmI)*100);return{WPM:e,TotalTime:n,Errors:errorsCount,Accuary:r}}function End(){typing=false;stats=Stats();$textToType.html('<div class="Resultats">'+"<h2>WPM: </h2>"+'<div class="WPM">'+Math.round(stats.WPM*100)/100+"</div>"+"<h2>Total Time: </h2>"+'<div class="Time">'+stats.TotalTime.HHMMSS()+"</div>"+"<h2>Errors: </h2>"+'<div class="Errors">'+stats.Errors+"</div>"+"<h2>Accuary: </h2>"+'<div class="Accuary">'+stats.Accuary+"%</div>"+"</div>"+'<div id="linechart_material" class="Graphique"></div>');drawChart(realTimeWPM,"linechart_material","RealTime WPM",["WPM","Erreurs"],"100%",250);if(STATS.Nb>0){STATS.WPM=(STATS.WPM*STATS.Nb+stats.WPM)/(STATS.Nb+1);STATS.Errors=(STATS.Errors*STATS.Nb+stats.Errors)/(STATS.Nb+1);STATS.Accuary=(STATS.Accuary*STATS.Nb+stats.Accuary)/(STATS.Nb+1)}else{STATS.WPM=stats.WPM;STATS.Errors=stats.Errors;STATS.Accuary=stats.Accuary}STATS.Nb++;$wpm.html("~"+Math.round(STATS.WPM*100)/100);$nb.html(STATS.Nb);$errors.html("~"+Math.round(STATS.Errors*100)/100);$accuary.html("~"+Math.round(STATS.Accuary*100)/100+"%")}function drawChart(e,t,n,r,i,s){var o=new google.visualization.DataTable;o.addColumn("number","");o.addColumn("number",r[0]);o.addColumn("number",r[1]);o.addRows([]);for(var u=0;u<e.length;u++){o.addRows([[u,e[u][0],+e[u][1]*10]])}var a={chart:{title:n,subtitle:""},width:i,height:s};var f=new google.charts.Line(document.getElementById(t));f.draw(o,a)}google.load("visualization","1.1",{packages:["line"]});var QUOTES=[];var THETEXT="";var DONEQUOTE=[];var whereAmI=0;var whichWord=0;var ERREUR=false;var typing=false;var $window=$(window);var $typingArea=$(".TypingArea");var $textToType=$(".TextToType");var $inputTyping=$(".InputTyping");var $changeQuote=$(".ChangeQuote");var $title=$(".title");var $author=$(".author");var $statsArea=$(".StatsArea");var $wpm=$(".WPM");var $nb=$(".Nb");var $errors=$(".Errors");var $accuary=$(".Accuary");var STATS={};var realTimeWPM=[];var beginTime;var endTime;var errorsCount=0;$.getJSON("json/quotes.json",function(e){QUOTES=e.quotes;STATS.WPM=null;STATS.Errors=null;STATS.Accuary=null;STATS.Nb=0;Main()});Date.prototype.HHMMSS=function(){var e,t,n;e=this.getHours()-1;t=this.getMinutes();n=this.getSeconds();if(e<10)e="0"+e;if(t<10)t="0"+t;if(n<10)n="0"+n;return e+":"+t+":"+n};String.prototype.addSpan=function(){var e="";var t=0;e="<span class='mot mot_"+t+"'>";for(var n=0;n<this.length;n++){if(this[n]!=" "){e+=this[n]}else{t++;e+="</span> <span class='mot mot_"+t+"'>"}}e+="</span>";return e};String.prototype.countMot=function(){var e=0;var t="";for(var n=0;n<this.length;n++){if(this[n]==" "&&this[n]!=t){e++}t=this[n]}return e};$window.keydown(function(e){if(!(e.ctrlKey||e.metaKey||e.altKey)){$inputTyping.focus()}if(!beginTime){beginTime=new Date}});$inputTyping.keyup(function(){if(typing){whereAmI=this.value.length-1;if(whereAmI<0)whereAmI=0;if(THETEXT.substr(0,whereAmI+1)==this.value){ERREUR=false;$textToType.css("border-color","#444")}else{ERREUR=true;errorsCount++;$textToType.css("border-color","red")}realTimeWPM.push([calculeWPM(beginTime,new Date),ERREUR]);if(ERREUR){colorizeWord(whichWord,"red")}else{whichWord=this.value.countMot();colorizeWord(whichWord,"green");if(THETEXT.length==this.value.length){$textToType.css("border-color","green");End()}}}});$changeQuote.click(function(){Main()});$inputTyping.bind("paste",function(e){e.preventDefault()})